## STM32 基本定时器

​	`STM32`内部集成了多个不同种类的定时器，其中分别为：**基本定时器** ， **通用定时器** ， **高级定时器**。

- **基本定时器**：顾名思义，结构最简单，多用作定时通断，主模式触发`DAC`等。**只能选择内部时钟进行驱动**。
- **通用定时器**：在完全拥有基本定时器的基础上，还拥有多路独立通道，并且具有**内外时钟源的选择**功能，具有**输入捕获**，**输出比较**功能，**编码器接口**，**主从触发模式**等功能。
- **高级定时器**：在拥有通用定时器的基础之上，额外具备了**死区生成**，**重复计数**，**互补输出**，**刹车输入**等功能。

除此之外，还有一些特殊的专用定时器，例如独立看门狗，实时时钟等等。

​	以下是基本定时器的结构图：

<img src="../../Pic/TIMb1.png" style="zoom:60%;" />

​	可以看到，基本定时器仅能由内部时钟信号驱动（通常来源于`APB1`的预分频输出），可通过`TRGO`引脚输出一个触发信号，或是时钟信号分频后作为计数频率来产生定时中断。

​	**自动重装定时器**（ARR）是一个提前就设定好值的，用于存储定时目标值的寄存器。对于`STM32F103C8T6`而言，其是大小为16位的寄存器，可计次65536次。当`CNT`计数器的值达到该目标值时，会产生一个更新事件，在中断通道正确使能的情况下，会立马产生一个更新中断，同时将`CNT`计数器的值置0，重新开始计数。

​	**为了增大计时的范围，在`CNT`计数器之前增加了一个预分频器，可将由内部时钟过来的时钟源进一步分频**。该预分频器依然是16位的，因此分频系数最多可进行65536分频。由 **f = 72*10^6 / 65536 , 65536 / f = T**,计算可得，最大计时范围`Tmax`在59秒左右。

​	注意：

​	对于预分频器，**分频系数 = 写入值 + 1**. 例如写1的话，则1+1=2 ， 为2分频。72/2 = 36mhz。

​	计数器是从0开始计数的，若要记数N个脉冲，则`ARR`应设置为`M - 1`！这样计数器CNT从0计数到`M - 1`，刚好N个数，触发更新事件 / 中断。





